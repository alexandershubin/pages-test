window.addEventListener("DOMContentLoaded",(function(){const e=/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/iu,t=document.querySelector(".form"),r=document.querySelector(".popup"),a=document.querySelector(".popup__content"),o=document.querySelector(".thank"),s=document.querySelector(".thank__content"),c=document.querySelector(".error-page"),n=document.querySelector(".error-page__content"),i="https://api.dating.com/identity",d=localStorage.getItem("token"),l=e=>location.href=`https://www.dating.com/people/#token=${e}`;if(d)return void l(d);const m=(e,t)=>{document.querySelectorAll(".close-popup").forEach((r=>{r.addEventListener("click",(r=>{r.preventDefault(),e.classList.remove("active"),t.classList.remove("active")}))})),document.addEventListener("keydown",(r=>{"Escape"===r.key&&(e.classList.remove("active"),t.classList.remove("active"))}))},u=(e,t)=>{const r=e.parentNode,a=document.createElement("span");a.classList.add("error-span"),a.textContent=t;const o=document.createElement("img");o.classList.add("error-img"),o.src="img/error.svg",o.alt="error",o.width=20,o.height=21,r.append(a),r.append(o),r.classList.add("error"),r.querySelector(".form__input").classList.add("active")};t.addEventListener("submit",(async d=>{d.preventDefault();const m=new FormData(t),v=Object.fromEntries(m.entries());if((t=>{let r=!0;return t.querySelectorAll("input").forEach((t=>{(e=>{const t=e.parentNode;t.classList.contains("error")&&(t.querySelector(".error-span").remove(),t.querySelector(".error-img").remove(),t.classList.remove("error"),t.querySelector(".form__input").classList.remove("active"))})(t),t.dataset.minLength&&t.value.length<t.dataset.minLength&&(u(t,"Please enter a valid password"),r=!1),t.dataset.name&&(e.test(t.value)||(u(t,"Please enter a valid email"),r=!1))})),r})(t)){const e=await(p=v.email,L=v.password,fetch(i,{headers:{"Content-Type":"application/json",Authorization:"Basic "+btoa(`${p}:${L}`)},method:"GET"}).then((e=>e.headers.get("x-token"))));if(e)return void l(e);await fetch(i,{headers:{"Content-Type":"application/json"},method:"PUT",body:JSON.stringify(v)}).then((e=>{if(e.ok){r.classList.remove("active"),a.classList.remove("active"),o.classList.add("active"),s.classList.add("active");const t=e.headers.get("x-token");return localStorage.setItem("token",t),t}throw r.classList.remove("active"),a.classList.remove("active"),c.classList.add("active"),n.classList.add("active"),Error("Авторизация не прошла")})).then((e=>{setTimeout((()=>l(e)),2e3)})).catch((e=>{console.log(e,"error")}))}var p,L})),document.querySelector(".participate__btn").addEventListener("click",(e=>{e.preventDefault(),r.classList.add("active"),a.classList.add("active")})),m(r,a),m(o,s),m(c,n)}));